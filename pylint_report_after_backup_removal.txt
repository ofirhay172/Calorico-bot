************* Module handlers
handlers.py:92:0: C0301: Line too long (104/100) (line-too-long)
handlers.py:158:0: C0325: Unnecessary parens after 'not' keyword (superfluous-parens)
handlers.py:179:0: C0325: Unnecessary parens after 'not' keyword (superfluous-parens)
handlers.py:202:0: C0325: Unnecessary parens after 'not' keyword (superfluous-parens)
handlers.py:401:0: C0303: Trailing whitespace (trailing-whitespace)
handlers.py:413:0: C0303: Trailing whitespace (trailing-whitespace)
handlers.py:436:0: C0303: Trailing whitespace (trailing-whitespace)
handlers.py:441:0: C0303: Trailing whitespace (trailing-whitespace)
handlers.py:456:0: C0303: Trailing whitespace (trailing-whitespace)
handlers.py:458:0: C0303: Trailing whitespace (trailing-whitespace)
handlers.py:515:0: C0303: Trailing whitespace (trailing-whitespace)
handlers.py:669:0: C0303: Trailing whitespace (trailing-whitespace)
handlers.py:723:0: C0303: Trailing whitespace (trailing-whitespace)
handlers.py:742:0: C0303: Trailing whitespace (trailing-whitespace)
handlers.py:760:0: C0301: Line too long (215/100) (line-too-long)
handlers.py:775:0: C0303: Trailing whitespace (trailing-whitespace)
handlers.py:782:0: C0303: Trailing whitespace (trailing-whitespace)
handlers.py:788:0: C0303: Trailing whitespace (trailing-whitespace)
handlers.py:790:0: C0301: Line too long (171/100) (line-too-long)
handlers.py:802:0: C0303: Trailing whitespace (trailing-whitespace)
handlers.py:809:0: C0303: Trailing whitespace (trailing-whitespace)
handlers.py:814:0: C0303: Trailing whitespace (trailing-whitespace)
handlers.py:819:0: C0303: Trailing whitespace (trailing-whitespace)
handlers.py:829:0: C0303: Trailing whitespace (trailing-whitespace)
handlers.py:897:0: C0303: Trailing whitespace (trailing-whitespace)
handlers.py:899:0: C0301: Line too long (143/100) (line-too-long)
handlers.py:943:0: C0303: Trailing whitespace (trailing-whitespace)
handlers.py:947:0: C0303: Trailing whitespace (trailing-whitespace)
handlers.py:951:0: C0303: Trailing whitespace (trailing-whitespace)
handlers.py:1106:0: C0301: Line too long (111/100) (line-too-long)
handlers.py:1229:0: C0303: Trailing whitespace (trailing-whitespace)
handlers.py:1237:0: C0303: Trailing whitespace (trailing-whitespace)
handlers.py:1247:0: C0301: Line too long (134/100) (line-too-long)
handlers.py:1248:0: C0301: Line too long (128/100) (line-too-long)
handlers.py:1250:0: C0301: Line too long (167/100) (line-too-long)
handlers.py:1252:0: C0301: Line too long (115/100) (line-too-long)
handlers.py:1253:0: C0301: Line too long (356/100) (line-too-long)
handlers.py:1254:0: C0301: Line too long (120/100) (line-too-long)
handlers.py:1271:0: C0303: Trailing whitespace (trailing-whitespace)
handlers.py:1281:0: C0303: Trailing whitespace (trailing-whitespace)
handlers.py:1291:0: C0301: Line too long (133/100) (line-too-long)
handlers.py:1292:0: C0301: Line too long (133/100) (line-too-long)
handlers.py:1343:0: C0303: Trailing whitespace (trailing-whitespace)
handlers.py:1354:0: C0303: Trailing whitespace (trailing-whitespace)
handlers.py:1364:0: C0303: Trailing whitespace (trailing-whitespace)
handlers.py:1367:0: C0301: Line too long (140/100) (line-too-long)
handlers.py:1445:0: C0303: Trailing whitespace (trailing-whitespace)
handlers.py:1569:0: C0301: Line too long (102/100) (line-too-long)
handlers.py:1:0: C0302: Too many lines in module (1603/1000) (too-many-lines)
handlers.py:59:1: W0511: TODO: 住祝 转  -handlers 拽抓 拽专,  砖, 转驻专, 转, free text,  '. (fixme)
handlers.py:341:1: W0511: TODO: 砖 注专 转  砖专 -handlers 拽抓 拽专,  free text, 转, , 转驻专 '. (fixme)
handlers.py:1551:9: W0511: TODO: Implement monthly report generation (fixme)
handlers.py:283:19: W0718: Catching too general exception Exception (broad-exception-caught)
handlers.py:320:15: W0718: Catching too general exception Exception (broad-exception-caught)
handlers.py:566:15: W0718: Catching too general exception Exception (broad-exception-caught)
handlers.py:567:12: W1203: Use lazy % formatting in logging functions (logging-fstring-interpolation)
handlers.py:710:8: R1705: Unnecessary "else" after "return", remove the "else" and de-indent the code inside it (no-else-return)
handlers.py:717:0: R0914: Too many local variables (31/15) (too-many-locals)
handlers.py:827:15: W0718: Catching too general exception Exception (broad-exception-caught)
handlers.py:851:4: R1705: Unnecessary "elif" after "return", remove the leading "el" from "elif" (no-else-return)
handlers.py:884:0: R0914: Too many local variables (18/15) (too-many-locals)
handlers.py:892:8: W0621: Redefining name 'eaten' from outer scope (line 717) (redefined-outer-name)
handlers.py:932:15: W0718: Catching too general exception Exception (broad-exception-caught)
handlers.py:933:12: W1203: Use lazy % formatting in logging functions (logging-fstring-interpolation)
handlers.py:1023:0: R0914: Too many local variables (30/15) (too-many-locals)
handlers.py:1064:12: R1705: Unnecessary "else" after "return", remove the "else" and de-indent the code inside it (no-else-return)
handlers.py:1067:31: E1121: Too many positional arguments for function call (too-many-function-args)
handlers.py:1069:31: E1121: Too many positional arguments for function call (too-many-function-args)
handlers.py:1071:31: E1121: Too many positional arguments for function call (too-many-function-args)
handlers.py:1104:12: R1705: Unnecessary "else" after "return", remove the "else" and de-indent the code inside it (no-else-return)
handlers.py:1219:11: W0718: Catching too general exception Exception (broad-exception-caught)
handlers.py:1220:8: W1203: Use lazy % formatting in logging functions (logging-fstring-interpolation)
handlers.py:1023:0: R0912: Too many branches (20/12) (too-many-branches)
handlers.py:1023:0: R0915: Too many statements (65/50) (too-many-statements)
handlers.py:1141:4: W0612: Unused variable 'is_question' (unused-variable)
handlers.py:1282:4: R1705: Unnecessary "elif" after "return", remove the leading "el" from "elif" (no-else-return)
handlers.py:1242:8: W0612: Unused variable 'calorie_budget' (unused-variable)
handlers.py:1274:4: W0612: Unused variable 'opt_track' (unused-variable)
handlers.py:1375:39: W0613: Unused argument 'context' (unused-argument)
handlers.py:1421:19: W0718: Catching too general exception Exception (broad-exception-caught)
handlers.py:1422:16: W1203: Use lazy % formatting in logging functions (logging-fstring-interpolation)
handlers.py:1461:11: W0718: Catching too general exception Exception (broad-exception-caught)
handlers.py:1450:26: R1732: Consider using 'with' for resource-allocating operations (consider-using-with)
handlers.py:1454:16: W0702: No exception type(s) specified (bare-except)
handlers.py:1462:8: W1203: Use lazy % formatting in logging functions (logging-fstring-interpolation)
handlers.py:1430:41: W0613: Unused argument 'context' (unused-argument)
handlers.py:1473:44: W0613: Unused argument 'context' (unused-argument)
handlers.py:1541:11: W0718: Catching too general exception Exception (broad-exception-caught)
handlers.py:1525:22: R1732: Consider using 'with' for resource-allocating operations (consider-using-with)
handlers.py:1529:12: W0702: No exception type(s) specified (bare-except)
handlers.py:1542:8: W1203: Use lazy % formatting in logging functions (logging-fstring-interpolation)
handlers.py:1544:0: W1404: Implicit string concatenation found in call (implicit-str-concat)
handlers.py:1599:11: W0718: Catching too general exception Exception (broad-exception-caught)
handlers.py:1582:22: R1732: Consider using 'with' for resource-allocating operations (consider-using-with)
handlers.py:1587:12: W0702: No exception type(s) specified (bare-except)
handlers.py:1600:8: W1203: Use lazy % formatting in logging functions (logging-fstring-interpolation)
handlers.py:1602:0: W1404: Implicit string concatenation found in call (implicit-str-concat)
handlers.py:1548:41: W0613: Unused argument 'user_id' (unused-argument)
handlers.py:8:0: W0611: Unused datetime imported from datetime (unused-import)
handlers.py:9:0: W0611: Unused Optional imported from typing (unused-import)
handlers.py:21:0: W0611: Unused SYSTEM_BUTTONS imported from config (unused-import)
handlers.py:37:0: W0611: Unused load_user imported from db (unused-import)
handlers.py:38:0: W0611: Unused clean_meal_text imported from utils (unused-import)
handlers.py:38:0: W0611: Unused set_openai_client imported from utils (unused-import)
************* Module utils
utils.py:122:0: C0303: Trailing whitespace (trailing-whitespace)
utils.py:125:0: C0303: Trailing whitespace (trailing-whitespace)
utils.py:129:0: C0301: Line too long (136/100) (line-too-long)
utils.py:132:0: C0303: Trailing whitespace (trailing-whitespace)
utils.py:134:0: C0301: Line too long (119/100) (line-too-long)
utils.py:135:0: C0303: Trailing whitespace (trailing-whitespace)
utils.py:137:0: C0301: Line too long (116/100) (line-too-long)
utils.py:138:0: C0303: Trailing whitespace (trailing-whitespace)
utils.py:140:0: C0301: Line too long (106/100) (line-too-long)
utils.py:141:0: C0303: Trailing whitespace (trailing-whitespace)
utils.py:150:0: C0303: Trailing whitespace (trailing-whitespace)
utils.py:165:0: C0301: Line too long (302/100) (line-too-long)
utils.py:167:0: C0301: Line too long (120/100) (line-too-long)
utils.py:168:0: C0301: Line too long (120/100) (line-too-long)
utils.py:173:0: C0301: Line too long (116/100) (line-too-long)
utils.py:176:0: C0301: Line too long (129/100) (line-too-long)
utils.py:177:0: C0301: Line too long (108/100) (line-too-long)
utils.py:21:5: W0511: TODO: 砖驻专 住 驻 爪专 (fixme)
utils.py:53:5: W0511: TODO: 砖驻专  转专 (fixme)
utils.py:1:0: C0114: Missing module docstring (missing-module-docstring)
utils.py:5:0: C0103: Constant name "_openai_client" doesn't conform to UPPER_CASE naming style (invalid-name)
utils.py:10:4: W0603: Using the global statement (global-statement)
utils.py:19:0: R0913: Too many arguments (6/5) (too-many-arguments)
utils.py:19:0: R0917: Too many positional arguments (6/5) (too-many-positional-arguments)
utils.py:44:4: R1705: Unnecessary "elif" after "return", remove the leading "el" from "elif" (no-else-return)
utils.py:67:15: W0718: Catching too general exception Exception (broad-exception-caught)
utils.py:128:8: R1705: Unnecessary "else" after "return", remove the "else" and de-indent the code inside it (no-else-return)
utils.py:120:4: W0612: Unused variable 'age' (unused-variable)
utils.py:121:4: W0612: Unused variable 'gender' (unused-variable)
************* Module db
db.py:80:9: W0511: TODO: 驻 砖转 转 (fixme)
db.py:93:9: W0511: TODO: 驻 砖转 拽专 (fixme)
db.py:1:0: C0114: Missing module docstring (missing-module-docstring)
db.py:29:0: R0913: Too many arguments (7/5) (too-many-arguments)
db.py:29:0: R0917: Too many positional arguments (7/5) (too-many-positional-arguments)
db.py:79:11: W0718: Catching too general exception Exception (broad-exception-caught)
db.py:92:11: W0718: Catching too general exception Exception (broad-exception-caught)
db.py:4:0: C0411: standard import "os" should be placed before first party import "config.USERS_FILE"  (wrong-import-order)
************* Module config
config.py:1:0: C0114: Missing module docstring (missing-module-docstring)
************* Module main
main.py:116:0: C0301: Line too long (115/100) (line-too-long)
main.py:137:0: C0303: Trailing whitespace (trailing-whitespace)
main.py:141:0: C0303: Trailing whitespace (trailing-whitespace)
main.py:173:0: C0301: Line too long (102/100) (line-too-long)
main.py:128:5: W0511: TODO: Implement proper scheduler (fixme)
main.py:70:25: W0613: Unused argument 'context' (unused-argument)
main.py:81:4: R0914: Too many local variables (18/15) (too-many-locals)
main.py:119:23: W0718: Catching too general exception Exception (broad-exception-caught)
main.py:120:20: W1203: Use lazy % formatting in logging functions (logging-fstring-interpolation)
main.py:124:4: W0612: Unused variable 'scheduler_tick' (unused-variable)
main.py:3:0: W0611: Unused import asyncio (unused-import)
main.py:21:0: W0611: Unused save_user imported from db (unused-import)
main.py:22:0: W0611: Unused after_questionnaire imported from handlers (unused-import)
main.py:22:0: W0611: Unused ask_water_reminder_opt_in imported from handlers (unused-import)
main.py:22:0: W0611: Unused check_dessert_permission imported from handlers (unused-import)
main.py:22:0: W0611: Unused daily_menu imported from handlers (unused-import)
main.py:22:0: W0611: Unused send_water_reminder imported from handlers (unused-import)
main.py:22:0: W0611: Unused show_daily_menu imported from handlers (unused-import)
main.py:22:0: W0611: Unused show_menu_with_keyboard imported from handlers (unused-import)
main.py:22:0: W0611: Unused show_reports_menu imported from handlers (unused-import)
main.py:61:0: W0611: Unused calculate_bmr imported from utils (unused-import)
************* Module report_generator
report_generator.py:47:0: C0301: Line too long (125/100) (line-too-long)
report_generator.py:307:0: C0301: Line too long (186/100) (line-too-long)
report_generator.py:149:5: W0511: TODO: 住祝  驻专转 转  (fixme)
report_generator.py:157:5: W0511: TODO: 住祝  驻专转 转  (fixme)
report_generator.py:150:4: W0107: Unnecessary pass statement (unnecessary-pass)
report_generator.py:145:19: W0613: Unused argument 'user_id' (unused-argument)
report_generator.py:145:28: W0613: Unused argument 'date' (unused-argument)
report_generator.py:145:34: W0613: Unused argument 'water_ml' (unused-argument)
report_generator.py:158:4: W0107: Unnecessary pass statement (unnecessary-pass)
report_generator.py:153:22: W0613: Unused argument 'user_id' (unused-argument)
report_generator.py:153:31: W0613: Unused argument 'date' (unused-argument)
report_generator.py:153:37: W0613: Unused argument 'exercise_type' (unused-argument)
report_generator.py:153:52: W0613: Unused argument 'duration_minutes' (unused-argument)
report_generator.py:153:70: W0613: Unused argument 'calories_burned' (unused-argument)
report_generator.py:200:0: R0914: Too many local variables (16/15) (too-many-locals)
report_generator.py:298:4: R1705: Unnecessary "elif" after "return", remove the leading "el" from "elif" (no-else-return)
report_generator.py:291:0: R1710: Either all return statements in a function should return an expression, or none of them should. (inconsistent-return-statements)
report_generator.py:310:0: R0914: Too many local variables (17/15) (too-many-locals)
report_generator.py:314:4: W0621: Redefining name 'datetime' from outer scope (line 11) (redefined-outer-name)
report_generator.py:314:4: W0621: Redefining name 'timedelta' from outer scope (line 11) (redefined-outer-name)
report_generator.py:314:4: W0404: Reimport 'datetime' (imported line 11) (reimported)
report_generator.py:314:4: W0404: Reimport 'timedelta' (imported line 11) (reimported)
report_generator.py:314:4: C0415: Import outside toplevel (datetime.datetime, datetime.timedelta) (import-outside-toplevel)
report_generator.py:328:4: C0415: Import outside toplevel (re) (import-outside-toplevel)
report_generator.py:11:0: C0411: standard import "datetime.datetime" should be placed before third party imports "matplotlib.pyplot", "matplotlib.dates", "numpy" (wrong-import-order)
report_generator.py:12:0: C0411: standard import "os" should be placed before third party imports "matplotlib.pyplot", "matplotlib.dates", "numpy" (wrong-import-order)
report_generator.py:9:0: W0611: Unused matplotlib.dates imported as mdates (unused-import)
report_generator.py:10:0: W0611: Unused numpy imported as np (unused-import)
report_generator.py:12:0: W0611: Unused import os (unused-import)
************* Module nutrition_db
nutrition_db.py:103:0: C0303: Trailing whitespace (trailing-whitespace)
nutrition_db.py:105:0: C0303: Trailing whitespace (trailing-whitespace)
nutrition_db.py:111:0: C0303: Trailing whitespace (trailing-whitespace)
nutrition_db.py:117:0: C0303: Trailing whitespace (trailing-whitespace)
nutrition_db.py:125:0: C0303: Trailing whitespace (trailing-whitespace)
nutrition_db.py:1:0: C0114: Missing module docstring (missing-module-docstring)
nutrition_db.py:7:0: C0116: Missing function or method docstring (missing-function-docstring)
nutrition_db.py:27:0: C0116: Missing function or method docstring (missing-function-docstring)
nutrition_db.py:27:0: R0913: Too many arguments (7/5) (too-many-arguments)
nutrition_db.py:27:0: R0917: Too many positional arguments (7/5) (too-many-positional-arguments)
nutrition_db.py:40:0: C0116: Missing function or method docstring (missing-function-docstring)
nutrition_db.py:94:15: W0718: Catching too general exception Exception (broad-exception-caught)
nutrition_db.py:109:4: W0702: No exception type(s) specified (bare-except)
nutrition_db.py:4:0: W0611: Unused datetime imported from datetime (unused-import)
nutrition_db.py:1:0: R0801: Similar lines in 2 files
==config:[7:27]
==handlers:[61:81]
(
    NAME,
    GENDER,
    AGE,
    HEIGHT,
    WEIGHT,
    GOAL,
    BODY_FAT,
    ACTIVITY,
    DIET,
    ALLERGIES,
    MENU,
    DAILY,
    EATEN,
    SUMMARY,
    SCHEDULE,
    EDIT,
    BODY_FAT_TARGET,
) = range(17)
 (duplicate-code)
nutrition_db.py:1:0: R0801: Similar lines in 2 files
==handlers:[1254:1266]
==utils:[178:190]
    )
    response = await _openai_client.chat.completions.create(
        model="gpt-4o", messages=[{"role": "user", "content": prompt}]
    )
    menu_text = (
        response.choices[0].message.content.strip()
        if response
        and response.choices
        and response.choices[0].message
        and response.choices[0].message.content
        else ""
    ) (duplicate-code)
nutrition_db.py:1:0: R0801: Similar lines in 2 files
==handlers:[765:772]
==utils:[183:190]
        response.choices[0].message.content.strip()
        if response
        and response.choices
        and response.choices[0].message
        and response.choices[0].message.content
        else ""
    ) (duplicate-code)
nutrition_db.py:1:0: R0801: Similar lines in 2 files
==nutrition_db:[86:92]
==utils:[59:65]
    match = re.search(r"(\d{1,2})[./-](\d{1,2})[./-](\d{2,4})", text)
    if match:
        day, month, year = map(int, match.groups())
        if year < 100:
            year += 2000
        try: (duplicate-code)
nutrition_db.py:1:0: R0801: Similar lines in 2 files
==handlers:[1331:1337]
==main:[94:100]
                    keyboard = [
                        [KeyboardButton("专转 专 驻  砖砖 转")],
                        [KeyboardButton(" 转 ")],
                        [KeyboardButton(" 转")],
                        [KeyboardButton("住转")],
                    ] (duplicate-code)
nutrition_db.py:1:0: R0801: Similar lines in 2 files
==handlers:[1193:1198]
==utils:[183:188]
            response.choices[0].message.content.strip()
            if response
            and response.choices
            and response.choices[0].message
            and response.choices[0].message.content (duplicate-code)

-----------------------------------
Your code has been rated at 7.91/10

